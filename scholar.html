<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Scholarships — ChatGoD</title>
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --bg:#07111a;
      --panel:#0b1720;
      --muted:#9aa7b2;
      --text:#e6eef3;
      --accent:#26a3ff;
      --glass: rgba(255,255,255,0.03);
      --radius:10px;
      --gap:12px;
      --font: "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#041018);font-family:var(--font);color:var(--text);font-size:13px;line-height:1.35}
    .container{display:grid;grid-template-columns:320px 1fr;gap:var(--gap);padding:18px;height:100vh;box-sizing:border-box}
    /* left panel */
    .left {
      background:linear-gradient(180deg,var(--panel), rgba(11,23,32,0.6));
      border-radius:var(--radius);
      padding:14px; box-shadow: 0 6px 20px rgba(0,0,0,0.5);
      display:flex;flex-direction:column;gap:12px;min-height:0;overflow:auto;
    }
    .brand {display:flex;align-items:center;gap:10px}
    .brand .logo {
      width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#7cf4ff);display:flex;align-items:center;justify-content:center;font-weight:700;color:#042;box-shadow:0 4px 14px rgba(38,163,255,0.12)
    }
    .brand h1{font-size:14px;margin:0;color:var(--text);font-weight:600}
    .select-wrap{display:flex;flex-direction:column;gap:6px}
    label{color:var(--muted);font-size:12px}
    select, input[type="search"] {
      background:var(--glass);border:1px solid rgba(255,255,255,0.03);color:var(--text);padding:8px 10px;border-radius:8px;font-size:13px;outline:none;
    }
    select:focus, input:focus{box-shadow:0 0 0 3px rgba(38,163,255,0.06);border-color:rgba(38,163,255,0.4)}
    .list-meta{ background-color:black; padding:12px;color:var(--muted);margin-top:6px}
    .small-muted{font-size:12px;color:var(--muted)}
    /* right panel */
    .right {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));
      border-radius:var(--radius);padding:16px; overflow:auto; min-height:0;
      box-shadow: 0 8px 30px rgba(0,0,0,0.55);
    }
    .grid {
      display:grid;grid-template-columns: 1fr 420px; gap:18px;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:8px;padding:14px;border:1px solid rgba(255,255,255,0.03);
    }
    h2 {margin:0 0 8px 0;font-size:16px;font-weight:700}
    .meta-row{display:flex;gap:8px;flex-wrap:wrap}
    .pill {background: rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
    table {width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px 10px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left;color:var(--text)}
    th{font-size:12px;color:var(--muted);font-weight:600}
    .muted{color:var(--muted)}
    a.site-link{color:var(--accent);text-decoration:none;font-weight:600}
    .note{font-size:12px;color:var(--muted);margin-top:8px}
    /* responsive */
    @media (max-width:980px) {
      .container {grid-template-columns:1fr; padding:12px}
      .grid {grid-template-columns:1fr}
      .left{order:2}
      .right{order:1}
    }

    /* Style for the select dropdown */
.college-select {
  background: #111;
  color: #ffd700; /* golden */
  font-weight: bold;
  border: none;
  border-radius: 6px;
  padding: 8px 12px;
  font-size: 16px;
}

/* Style for the dropdown options */
.college-select option {
  background: #111;
  color: #ffd700; /* golden */
  font-weight: bold;
}

/* If you want white text instead of golden, use: */
.college-select,
.college-select option {
  color: #fff;
}
  </style>
</head>
<body>
  <div class="container" role="main" aria-labelledby="page-title">
    <div class="left" aria-label="controls">
      <div class="brand">
        <div>
          <h1 id="page-title">Scholarships — Data Grid</h1>
          <div class="small-muted">Small, readable, dark theme — consolidated view</div>
        </div>
      </div>

      <div class="select-wrap">
        <label for="sch-select">Choose scholarship (short name)</label>
        <select id="sch-select" aria-label="Scholarship select" class="college-select">
          <option value="">Loading…</option>
        </select>
        <div class="list-meta" id="list-meta">Select a scholarship to view details</div>
      </div>

      <div style="margin-top:8px">
        <label for="search-box">Quick filter</label>
        <input id="search-box" type="search" placeholder="filter scholarship names" aria-label="filter" />
      </div>

      <div style="margin-top:auto">
        <div class="small-muted">Tip: selecting a scholarship shows aggregated info (courses grouped on the right).</div>
      </div>
    </div>

    <div class="right" id="detail">
      <div class="card" id="placeholder">
        <h2>Pick a scholarship</h2>
        <div class="muted">Choose a scholarship from the left to view criteria, documents, eligible categories, and course-wise sanctioned amounts.</div>
      </div>
    </div>
  </div>

<script>
(async function(){
  const API_BASE = '/Api/scholarships.php'; // adjust if API path different
  const select = document.getElementById('sch-select');
  const listMeta = document.getElementById('list-meta');
  const detail = document.getElementById('detail');
  const searchBox = document.getElementById('search-box');

  // fetch name list
  async function fetchList() {
    try {
      const res = await fetch(API_BASE);
      const j = await res.json();
      if (!j || j.status !== 'ok' || !Array.isArray(j.list)) {
        select.innerHTML = '<option value="">No data</option>';
        listMeta.textContent = 'Unable to fetch list';
        return;
      }
      populateList(j.list);
    } catch (e) {
      console.error(e);
      select.innerHTML = '<option value="">Error</option>';
      listMeta.textContent = 'Network error';
    }
  }

  function populateList(list) {
    // sort by name
    list.sort((a,b) => a.name.localeCompare(b.name));
    select.innerHTML = '<option value="">-- select scholarship --</option>';
    for (const item of list) {
      const opt = document.createElement('option');
      opt.value = item.name;
      opt.textContent = item.name + (item.count ? `  — ${item.count}` : '');
      select.appendChild(opt);
    }
    listMeta.textContent = `${list.length} scholarship types`;
  }

  // fetch consolidated detail by name
  async function fetchDetail(name) {
    if (!name) {
      detail.innerHTML = `<div class="card"><h2>Pick a scholarship</h2><div class="muted">Choose a scholarship from the left to view criteria and courses.</div></div>`;
      return;
    }
    detail.innerHTML = `<div class="card"><h2>Loading…</h2><div class="muted">Fetching consolidated data for <strong>${escapeHtml(name)}</strong></div></div>`;
    try {
      const u = API_BASE + '?name=' + encodeURIComponent(name);
      const res = await fetch(u);
      const j = await res.json();
      if (!j || j.status !== 'ok') {
        detail.innerHTML = `<div class="card"><h2>Error</h2><div class="muted">${escapeHtml(j && j.message ? j.message : 'Unable to fetch data')}</div></div>`;
        return;
      }
      renderDetail(j);
    } catch (e) {
      console.error(e);
      detail.innerHTML = `<div class="card"><h2>Error</h2><div class="muted">Network error</div></div>`;
    }
  }

  function renderDetail(data) {
    // left summary and right courses grid
    const leftHtml = `
      <div class="card">
        <h2>${escapeHtml(data.name)}</h2>
        <div class="meta-row" style="margin-bottom:8px">
          <div class="pill">${data.income_limit_text ? escapeHtml(data.income_limit_text) : 'Income: N/A'}</div>
          ${data.income_min ? `<div class="pill">Min ₹${numberWithCommas(data.income_min)}</div>` : ''}
          ${data.income_max ? `<div class="pill">Max ₹${numberWithCommas(data.income_max)}</div>` : ''}
        </div>

        <div style="font-weight:600;margin-bottom:6px">Eligibility / Criteria</div>
        <div class="muted" style="white-space:pre-wrap">${escapeHtml(data.criteria || 'Not specified')}</div>

        <div style="font-weight:600;margin-top:10px;margin-bottom:6px">Required Documents</div>
        <div class="muted">${(data.documents_required && data.documents_required.length) ? data.documents_required.map(d=>escapeHtml(d)).join(', ') : 'Not specified'}</div>

        <div style="font-weight:600;margin-top:10px;margin-bottom:6px">Eligible Categories</div>
        <div>${(data.eligibility_categories && data.eligibility_categories.length) ? data.eligibility_categories.map(c=>`<span class="pill">${escapeHtml(c)}</span>`).join(' ') : '<span class="muted">Not specified</span>'}</div>

        <div style="font-weight:600;margin-top:10px;margin-bottom:6px">Payment Remark</div>
        <div class="muted">${escapeHtml(data.payment_remark || 'Not specified')}</div>

        <div style="font-weight:600;margin-top:10px;margin-bottom:6px">Reference Links</div>
        <div>${(data.site_urls && data.site_urls.length) ? data.site_urls.map(u=>`<div><a class="site-link" href="${escapeAttr(u)}" target="_blank" rel="noopener noreferrer">${escapeHtml(u)}</a></div>`).join('') : '<div class="muted">No links</div>'}</div>

        <div class="note">Source: Consolidated from imported MAIN_SCHOLAR_DATA records.</div>
      </div>
    `;

    // courses table to the right
    let coursesHtml = `<div class="card"><h2 style="margin-bottom:8px">Courses & Sanction Amounts</h2>`;
    if (data.courses && data.courses.length) {
      coursesHtml += `<table aria-label="courses table"><thead><tr><th>Course / Year</th><th>Sanction (text)</th><th style="width:120px">Amount (min)</th></tr></thead><tbody>`;
      for (const c of data.courses) {
        coursesHtml += `<tr>
          <td>${escapeHtml(c.course_label)}</td>
          <td class="muted">${escapeHtml(c.scholarship_text || '')}</td>
          <td>${c.sch_min ? '₹' + numberWithCommas(c.sch_min) : '-'}</td>
        </tr>`;
      }
      coursesHtml += `</tbody></table>`;
    } else {
      coursesHtml += `<div class="muted">No course-level data available.</div>`;
    }
    coursesHtml += `</div>`;

    // put both into a two-column grid inside detail
    detail.innerHTML = `<div class="grid">${leftHtml}<div>${coursesHtml}</div></div>`;
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch])); }
  function escapeAttr(s){ return String(s).replace(/"/g,'&quot;'); }
  function numberWithCommas(x){ return String(x).replace(/\B(?=(\d{3})+(?!\d))/g, ","); }

  // wire select change
  select.addEventListener('change', ()=> {
    const v = select.value;
    fetchDetail(v);
  });

  // live filter on the left
  searchBox.addEventListener('input', ()=> {
    const q = searchBox.value.trim().toLowerCase();
    for (const opt of select.options) {
      if (!opt.value) continue;
      const show = !q || opt.value.toLowerCase().includes(q);
      opt.hidden = !show;
    }
  });

  // initial load
  await fetchList();

  // if URL has ?name= preselect
  const urlParams = new URLSearchParams(window.location.search);
  const pre = urlParams.get('name');
  if (pre) {
    // try to select exact option
    setTimeout(()=> {
      const opt = Array.from(select.options).find(o => o.value.toLowerCase() === pre.toLowerCase());
      if (opt) { select.value = opt.value; select.dispatchEvent(new Event('change')); }
    }, 150);
  }

})();
</script>
</body>
</html>
